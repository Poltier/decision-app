<div class="profile-container">

  <h2>Avatar Selection</h2>
  <div class="avatar-selection">
      <div *ngFor="let avatar of avatars" (click)="selectAvatar(avatar)">
        <img [src]="avatar" [class.selected]="avatar === selectedAvatar">
      </div>
  </div>

  <h2>Information Updation</h2>
  <form [formGroup]="profileForm" class="profile-form">
    <!-- Nuevo campo de email -->
    <mat-form-field appearance="fill">
        <mat-label>New Email</mat-label>
        <input matInput formControlName="newEmail" type="email">
        <mat-error *ngIf="profileForm.get('newEmail')?.errors?.['email']">Please enter a valid email</mat-error>
        <mat-error *ngIf="profileForm.get('newEmail')?.errors?.['required']">Email is required</mat-error>
    </mat-form-field>

    <button mat-raised-button color="primary" (click)="updateEmail()" [disabled]="profileForm.get('newEmail')?.invalid">Update Email</button>

    <!-- Botón de cambio de contraseña -->
    <button mat-raised-button color="accent" (click)="updatePassword()">Change Password</button>
  </form>
  <h2>Modify your Questions</h2>
  <div *ngIf="userQuestions.length > 0; else noQuestions" class="table-container">
      <mat-table [dataSource]="userQuestions">
        <ng-container matColumnDef="question">
          <mat-header-cell *matHeaderCellDef> Question </mat-header-cell>
          <mat-cell *matCellDef="let question"> {{ question.questionText }} </mat-cell>
        </ng-container>
        <ng-container matColumnDef="correctOption">
          <mat-header-cell *matHeaderCellDef> Correct Option </mat-header-cell>
          <mat-cell *matCellDef="let question"> {{ getCorrectOptionText(question.options) }} </mat-cell>
        </ng-container>
        <ng-container matColumnDef="incorrectOption">
          <mat-header-cell *matHeaderCellDef> Incorrect Option </mat-header-cell>
          <mat-cell *matCellDef="let question"> {{ getIncorrectOptionText(question.options) }} </mat-cell>
        </ng-container>
        <ng-container matColumnDef="image">
          <mat-header-cell *matHeaderCellDef> Image </mat-header-cell>
          <mat-cell *matCellDef="let question"> <a href="{{ question.imageUrl }}" target="_blank">View Image</a> </mat-cell>
        </ng-container>
        <ng-container matColumnDef="thematic">
          <mat-header-cell *matHeaderCellDef> Thematic </mat-header-cell>
          <mat-cell *matCellDef="let question"> {{ question.thematic }} </mat-cell>
        </ng-container>
        <ng-container matColumnDef="createdAt">
          <mat-header-cell *matHeaderCellDef> Creation Date </mat-header-cell>
          <mat-cell *matCellDef="let question"> {{ question.createdAt }} </mat-cell>
        </ng-container>
        <ng-container matColumnDef="status">
          <mat-header-cell *matHeaderCellDef> Status </mat-header-cell>
          <mat-cell *matCellDef="let question"> {{ question.approved ? 'Approved' : 'Pending' }} </mat-cell>
        </ng-container>
        <ng-container matColumnDef="actions">
          <mat-header-cell *matHeaderCellDef> Actions </mat-header-cell>
          <mat-cell *matCellDef="let question">
            <button *ngIf="!question.approved && !isEditing" mat-button (click)="editQuestion(question)">Edit</button>
          </mat-cell>
        </ng-container>
        <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
        <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
      </mat-table>
      <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
  </div>

  <div *ngIf="isEditing" class="edition-question-container">
    <form [formGroup]="questionForm" (ngSubmit)="saveEditedQuestion()" class="edition-question-form">

      <mat-form-field appearance="fill">
        <mat-label>Question</mat-label>
        <input matInput type="text" id="questionText" formControlName="questionText">
        <mat-error *ngIf="questionForm.controls['questionText'].hasError('required')">
          Question is required.
        </mat-error>
        <mat-error *ngIf="questionForm.controls['questionText'].hasError('maxlength')">
          Question can not be more than 120 characters.
        </mat-error>
      </mat-form-field>
            
      <mat-form-field appearance="fill">
        <mat-label>Image URL</mat-label>
        <input matInput type="text" id="imageUrl" formControlName="imageUrl">
          <mat-error *ngIf="questionForm.controls['imageUrl'].hasError('required')">
            Image URL is required.
          </mat-error>
      </mat-form-field>
            
      <mat-form-field appearance="fill">
        <mat-label>Option 1</mat-label>
        <input matInput type="text" id="option1" formControlName="option1">
        <mat-error *ngIf="questionForm.controls['option1'].hasError('required')">
          Option 1 is required.
        </mat-error>
        <mat-error *ngIf="questionForm.controls['option1'].hasError('maxlength')">
          Question can not be more than 40 characters.
        </mat-error>
      </mat-form-field>
            
      <mat-form-field appearance="fill">
        <mat-label>Option 2</mat-label>
        <input matInput type="text" id="option2" formControlName="option2">
        <mat-error *ngIf="questionForm.controls['option2'].hasError('required')">
          Option 2 is required.
        </mat-error>
        <mat-error *ngIf="questionForm.controls['option2'].hasError('maxlength')">
          Question can not be more than 40 characters.
        </mat-error>
      </mat-form-field>
            
      <mat-form-field appearance="fill">
        <mat-label>Correct Option</mat-label>
        <mat-select id="correctOption" formControlName="correctOption">
          <mat-option value="option1">Option 1</mat-option>
          <mat-option value="option2">Option 2</mat-option>
        </mat-select>
        <mat-error *ngIf="questionForm.controls['correctOption'].hasError('required')">
          You must select the correct option.
        </mat-error>
        </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Thematic</mat-label>
        <mat-select formControlName="thematic">
        <mat-option *ngFor="let thematic of thematics" [value]="thematic">
          {{ thematic }}
        </mat-option>
        </mat-select>
        <mat-error *ngIf="questionForm.controls['thematic'].hasError('required')">
          Thematic is required.
        </mat-error>
      </mat-form-field>

      <button *ngIf="isEditing" mat-raised-button color="accent" (click)="saveEditedQuestion()">Save</button>
      <button *ngIf="isEditing" mat-raised-button color="warn" (click)="cancelEdit()">Discard</button>
    </form>
  </div>

  <ng-template #noQuestions> 
    <p>You have not submitted any questions.</p>
  </ng-template>
</div>
  
